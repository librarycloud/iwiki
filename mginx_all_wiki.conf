 #  wikipedia to www.wikipedia
    server {
    server_name wikipedia.youdomain.org;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
         ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
    }
   rewrite ^ https://www.wikipedia.youdomain.org$request_uri;
   }


 # all languages wikipedia
    server {
    server_name  ~^(?<subdomain>[^.]+)\.wikipedia\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
    ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
     if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
       }
    
    if ($http_x_forwarded_proto = 'http')
     {
        return 301 https://$subdomain.wikipedia.youdomain.org$request_uri;
     }

    location / {
        proxy_pass https://$subdomain.wikipedia.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikipedia.org/ https://$subdomain.wikipedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikipedia.org/ https://$subdomain.m.wikipedia.youdomain.org/;
        proxy_cookie_domain wikipedia.org wikipedia.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;

        proxy_redirect ~^https://([\w\.]+).wikipedia.org/(.*?)$ https://$1.wikipedia.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;

        proxy_set_header       Host $subdomain.wikipedia.org;

        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             "wikisource.org" "wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";


        sub_filter_once        off;
        sub_filter_types       *;
        }
     }

    server {
    server_name ~^(?<subdomain>[^.]+)\.m\.wikipedia\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
    ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
    }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 $https://subdomain.m.wikipedia.youdomain.org$request_uri;
    }

    location / {
        proxy_pass https://$subdomain.m.wikipedia.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikipedia.org/ https://$subdomain.wikipedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikipedia.org/ https://$subdomain.m.wikipedia.youdomain.org/;
        proxy_cookie_domain wikipedia.org wikipedia.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;

        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;

        proxy_set_header       Host $subdomain.m.wikipedia.org;

        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;


        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
         }
    }
 # wikimedia
    server {
    server_name  ~^(?<subdomain>[^.]+)\.wikimedia\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
    ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
       }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 https://$subdomain.wikimedia.youdomain.org$request_uri;
    }

    location / {
        proxy_pass https://$subdomain.wikimedia.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ https://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikipedia.org wikipedia.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;
        proxy_cookie_domain             wmfusercontent.org wmfusercontent.youdomain.org;
        proxy_cookie_domain             wikimediafoundation.org wikimediafoundation.youdomain.org;
        proxy_cookie_domain             wiktionary.org wiktionary.youdomain.org;
        proxy_cookie_domain             wikivoyage.org wikivoyage.youdomain.org;
        proxy_cookie_domain             wikiversity.org wikiversity.youdomain.org;
        proxy_cookie_domain             wikisource.org wikisource.youdomain.org;
        proxy_cookie_domain             wikiquote.org wikiquote.youdomain.org;
        proxy_cookie_domain             wikinews.org wikinews.youdomain.org;
        proxy_cookie_domain             wikidata.org wikidata.youdomain.org;
        proxy_cookie_domain             wikibooks.org wikibooks.youdomain.org;
        proxy_cookie_domain             mediawiki.org mediawiki.youdomain.org;

        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikipedia.org/(.*?)$ https://$1.wikipedia.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wmfusercontent.org/(.*?)$ https://$1.wmfusercontent.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimediafoundation.org/(.*?)$ https://$1.wikimediafoundation.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wiktionary.org/(.*?)$ https://$1.wiktionary.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikivoyage.org/(.*?)$ https://$1.wikivoyage.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikiversity.org/(.*?)$ https://$1.wikiversity.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikisource.org/(.*?)$ https://$1.wikisource.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikiquote.org/(.*?)$ https://$1.wikiquote.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikinews.org/(.*?)$ https://$1.wikinews.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikidata.org/(.*?)$ https://$1.wikidata.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikibooks.org/(.*?)$ https://$1.wikibooks.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).mediawiki.org/(.*?)$ https://$1.mediawiki.youdomain.org/$2;

        proxy_set_header       Host $subdomain.wikimedia.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
     }
    }

    server {
    server_name ~^(?<subdomain>[^.]+)\.m\.wikimedia\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
   ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
    }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 $subdomain.m.wikimedia.youdomain.org$request_uri;
    }

    location / {
        proxy_pass https://$subdomain.m.wikimedia.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ http://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikipedia.org wikipedia.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;
        proxy_cookie_domain             wmfusercontent.org wmfusercontent.youdomain.org;
        proxy_cookie_domain             wikimediafoundation.org wikimediafoundation.youdomain.org;
        proxy_cookie_domain             wiktionary.org wiktionary.youdomain.org;
        proxy_cookie_domain             wikivoyage.org wikivoyage.youdomain.org;
        proxy_cookie_domain             wikiversity.org wikiversity.youdomain.org;
        proxy_cookie_domain             wikisource.org wikisource.youdomain.org;
        proxy_cookie_domain             wikiquote.org wikiquote.youdomain.org;
        proxy_cookie_domain             wikinews.org wikinews.youdomain.org;
        proxy_cookie_domain             wikidata.org wikidata.youdomain.org;
        proxy_cookie_domain             wikibooks.org wikibooks.youdomain.org;
        proxy_cookie_domain             mediawiki.org mediawiki.youdomain.org;

        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikipedia.org/(.*?)$ https://$1.wikipedia.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wmfusercontent.org/(.*?)$ https://$1.wmfusercontent.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimediafoundation.org/(.*?)$ https://$1.wikimediafoundation.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wiktionary.org/(.*?)$ https://$1.wiktionary.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikivoyage.org/(.*?)$ https://$1.wikivoyage.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikiversity.org/(.*?)$ https://$1.wikiversity.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikisource.org/(.*?)$ https://$1.wikisource.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikiquote.org/(.*?)$ https://$1.wikiquote.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikinews.org/(.*?)$ https://$1.wikinews.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikidata.org/(.*?)$ https://$1.wikidata.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikibooks.org/(.*?)$ https://$1.wikibooks.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).mediawiki.org/(.*?)$ https://$1.mediawiki.youdomain.org/$2;

        proxy_set_header       Host $subdomain.m.wikimedia.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
      }
    }


 # wiktionary
    server {
    server_name  ~^(?<subdomain>[^.]+)\.wiktionary\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
    ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
       }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 https://$subdomain.wiktionary.youdomain.org$request_uri;
    }

    location / {
        proxy_pass https://$subdomain.wiktionary.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ https://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wiktionary.org wiktionary.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;


        proxy_redirect ~^https://([\w\.]+).wiktionary.org/(.*?)$ https://$1.wiktionary.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;


        proxy_set_header       Host $subdomain.wiktionary.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
     }
    }

    server {
    server_name ~^(?<subdomain>[^.]+)\.m\.wiktionary\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
   ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
    }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 $subdomain.m.wiktionary.youdomain.org$request_uri;
    }

    location / {
        proxy_pass https://$subdomain.m.wiktionary.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ http://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wiktionary.org wiktionary.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;

        proxy_redirect ~^https://([\w\.]+).wiktionary.org/(.*?)$ https://$1.wiktionary.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;

        proxy_set_header       Host $subdomain.m.wiktionary.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
      }
    }

 
 # wikisource homepage
    server {
    server_name  wikisource.youdomain.org www.wikisource.youdomain.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
    ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
       }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 https://wikisource.youdomain.org$request_uri;
     }
    location / {
        proxy_pass https://wikisource.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ https://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikisource.org wikisource.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;

        proxy_redirect https://wikisource.org/ https://wikisource.youdomain.org/;

        proxy_redirect ~^https://([\w\.]+).wikisource.org/(.*?)$ https://$1.wikisource.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;


        proxy_set_header       Host wikisource.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
     }
    }

 
 # all languages wikisource
    server {
    server_name  ~^(?<subdomain>[^.]+)\.wikisource\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
    ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
       }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 https://$subdomain.wikisource.youdomain.org$request_uri;
     }

    location / {
        proxy_pass https://$subdomain.wikisource.org;
        proxy_buffering off;

        proxy_redirect https://wikisource.org/ https://wikisource.youdomain.org/;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ https://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikisource.org wikisource.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;


        proxy_redirect ~^https://([\w\.]+).wikisource.org/(.*?)$ https://$1.wikisource.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;


        proxy_set_header       Host $subdomain.wikisource.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
     }
    }

    server {
    server_name ~^(?<subdomain>[^.]+)\.m\.wikisource\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
   ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
    }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 $subdomain.m.wikisource.youdomain.org$request_uri;
    }

    location / {
        proxy_pass https://$subdomain.m.wikisource.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ http://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikisource.org wikisource.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;


        proxy_redirect ~^https://([\w\.]+).wikisource.org/(.*?)$ https://$1.wikisource.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;

        proxy_set_header       Host $subdomain.m.wikisource.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
      }
    }


 # wmfusercontent
    server {
    server_name  ~^(?<subdomain>[^.]+)\.wmfusercontent\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
    ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
       }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 https://$subdomain.wmfusercontent.youdomain.org$request_uri;
     }

    location / {
        proxy_pass https://$subdomain.wmfusercontent.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ https://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wmfusercontent.org wmfusercontent.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;

        proxy_redirect ~^https://([\w\.]+).wmfusercontent.org/(.*?)$ https://$1.wmfusercontent.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;

        proxy_set_header       Host $subdomain.wmfusercontent.org;

        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
     }
    }

    server {
    server_name ~^(?<subdomain>[^.]+)\.m\.wmfusercontent\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
   ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
    }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 $subdomain.m.wmfusercontent.youdomain.org$request_uri;
    }

    location / {
        proxy_pass https://$subdomain.m.wmfusercontent.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ http://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wmfusercontent.org wmfusercontent.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;

        proxy_redirect ~^https://([\w\.]+).wmfusercontent.org/(.*?)$ https://$1.wmfusercontent.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;

        proxy_set_header       Host $subdomain.m.wmfusercontent.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
      }
    }


 # wikimediafoundation
    server {
    server_name  ~^(?<subdomain>[^.]+)\.wikimediafoundation\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
    ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
       }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 https://$subdomain.wikimediafoundation.youdomain.org$request_uri;
     }

    location / {
        proxy_pass https://$subdomain.wikimediafoundation.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ https://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikimediafoundation.org wikimediafoundation.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;

        proxy_redirect ~^https://([\w\.]+).wikimediafoundation.org/(.*?)$ https://$1.wikimediafoundation.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;



        proxy_set_header       Host $subdomain.wikimediafoundation.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
     }
    }

    server {
    server_name ~^(?<subdomain>[^.]+)\.m\.wikimediafoundation\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
   ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
    }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 $subdomain.m.wikimediafoundation.youdomain.org$request_uri;
    }

    location / {
        proxy_pass https://$subdomain.m.wikimediafoundation.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ http://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikimediafoundation.org wikimediafoundation.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;


        proxy_redirect ~^https://([\w\.]+).wikimediafoundation.org/(.*?)$ https://$1.wikimediafoundation.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;

        proxy_set_header       Host $subdomain.m.wikimediafoundation.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
      }
    }



 # wikivoyage
    server {
    server_name  ~^(?<subdomain>[^.]+)\.wikivoyage\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
    ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
       }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 https://$subdomain.wikivoyage.youdomain.org$request_uri;
     }

    location / {
        proxy_pass https://$subdomain.wikivoyage.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ https://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikivoyage.org wikivoyage.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;


        proxy_redirect ~^https://([\w\.]+).wikivoyage.org/(.*?)$ https://$1.wikivoyage.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;


        proxy_set_header       Host $subdomain.wikivoyage.org;

        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
     }
    }

    server {
    server_name ~^(?<subdomain>[^.]+)\.m\.wikivoyage\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
   ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
    }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 $subdomain.m.wikivoyage.youdomain.org$request_uri;
    }

    location / {
        proxy_pass https://$subdomain.m.wikivoyage.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ http://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikivoyage.org wikivoyage.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;

        proxy_redirect ~^https://([\w\.]+).wikivoyage.org/(.*?)$ https://$1.wikivoyage.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;


        proxy_set_header       Host $subdomain.wikivoyage.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
      }
    }
    
 # wikiversity
    server {
    server_name  ~^(?<subdomain>[^.]+)\.wikiversity\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
    ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
       }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 https://$subdomain.wikiversity.youdomain.org$request_uri;
     }

    location / {
        proxy_pass https://$subdomain.wikiversity.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ https://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikiversity.org wikiversity.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;

        proxy_redirect ~^https://([\w\.]+).wikiversity.org/(.*?)$ https://$1.wikiversity.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;



        proxy_set_header       Host $subdomain.wikiversity.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
     }
    }

    server {
    server_name ~^(?<subdomain>[^.]+)\.m\.wikiversity\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
   ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
    }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 $subdomain.m.wikiversity.youdomain.org$request_uri;
    }

    location / {
        proxy_pass https://$subdomain.m.wikiversity.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ http://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikiversity.org wikiversity.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;

        proxy_redirect ~^https://([\w\.]+).wikiversity.org/(.*?)$ https://$1.wikiversity.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;

        proxy_set_header       Host $subdomain.m.wikiversity.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
      }
    }
    
 # wikiquote
    server {
    server_name  ~^(?<subdomain>[^.]+)\.wikiquote\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
    ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
       }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 https://$subdomain.wikiquote.youdomain.org$request_uri;
     }

    location / {
        proxy_pass https://$subdomain.wikiquote.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ https://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikiquote.org wikiquote.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;


        proxy_redirect ~^https://([\w\.]+).wikiquote.org/(.*?)$ https://$1.wikiquote.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;


        proxy_set_header       Host $subdomain.wikiquote.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
     }
    }

    server {
    server_name ~^(?<subdomain>[^.]+)\.m\.wikiquote\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
   ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
    }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 $subdomain.m.wikiquote.youdomain.org$request_uri;
    }

    location / {
        proxy_pass https://$subdomain.m.wikiquote.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ http://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikiquote.org wikiquote.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;

        proxy_redirect ~^https://([\w\.]+).wikiquote.org/(.*?)$ https://$1.wikiquote.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;

        proxy_set_header       Host $subdomain.m.wikiquote.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
      }
    }
    
 # wikinews
    server {
    server_name  ~^(?<subdomain>[^.]+)\.wikinews\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
    ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
       }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 https://$subdomain.wikinews.youdomain.org$request_uri;
     }

    location / {
        proxy_pass https://$subdomain.wikinews.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ https://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikinews.org wikinews.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;


        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikinews.org/(.*?)$ https://$1.wikinews.youdomain.org/$2;


        proxy_set_header       Host $subdomain.wikinews.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
     }
    }

    server {
    server_name ~^(?<subdomain>[^.]+)\.m\.wikinews\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
   ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
    }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 $subdomain.m.wikinews.youdomain.org$request_uri;
    }

    location / {
        proxy_pass https://$subdomain.m.wikinews.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ http://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikinews.org wikinews.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;

        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikinews.org/(.*?)$ https://$1.wikinews.youdomain.org/$2;

        proxy_set_header       Host $subdomain.m.wikinews.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
      }
    }
    
 # wikidata
    server {
    server_name  ~^(?<subdomain>[^.]+)\.wikidata\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
    ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
       }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 https://$subdomain.wikidata.youdomain.org$request_uri;
     }

    location / {
        proxy_pass https://$subdomain.wikidata.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ https://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikidata.org wikidata.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;


        proxy_redirect ~^https://([\w\.]+).wikidata.org/(.*?)$ https://$1.wikidata.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;


        proxy_set_header       Host $subdomain.wikidata.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
     }
    }

    server {
    server_name ~^(?<subdomain>[^.]+)\.m\.wikidata\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
   ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
    }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 $subdomain.m.wikidata.youdomain.org$request_uri;
    }

    location / {
        proxy_pass https://$subdomain.m.wikidata.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ http://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikidata.org wikidata.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;


        proxy_redirect ~^https://([\w\.]+).wikidata.org/(.*?)$ https://$1.wikidata.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;

        proxy_set_header       Host $subdomain.m.wikidata.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
      }
    }
    
 # wikibooks
    server {
    server_name  ~^(?<subdomain>[^.]+)\.wikibooks\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
    ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
       }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 https://$subdomain.wikibooks.youdomain.org$request_uri;
     }

    location / {
        proxy_pass https://$subdomain.wikibooks.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ https://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikibooks.org wikibooks.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;


        proxy_redirect ~^https://([\w\.]+).wikibooks.org/(.*?)$ https://$1.wikibooks.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;

        proxy_set_header       Host $subdomain.wikibooks.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
     }
    }

    server {
    server_name ~^(?<subdomain>[^.]+)\.m\.wikibooks\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
   ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
    }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 $subdomain.m.wikibooks.youdomain.org$request_uri;
    }

    location / {
        proxy_pass https://$subdomain.m.wikibooks.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ http://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain wikibooks.org wikibooks.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;


        proxy_redirect ~^https://([\w\.]+).wikibooks.org/(.*?)$ https://$1.wikibooks.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;

        proxy_set_header       Host $subdomain.m.wikibooks.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
      }
    }
    
 # mediawiki
    server {
    server_name  ~^(?<subdomain>[^.]+)\.mediawiki\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
    ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
       }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 https://$subdomain.mediawiki.youdomain.org$request_uri;
     }

    location / {
        proxy_pass https://$subdomain.mediawiki.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ https://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain mediawiki.org mediawiki.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;


        proxy_redirect ~^https://([\w\.]+).mediawiki.org/(.*?)$ https://$1.mediawiki.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;

        proxy_set_header       Host $subdomain.mediawiki.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
     }
    }

    server {
    server_name ~^(?<subdomain>[^.]+)\.m\.mediawiki\.iwiki\.eu\.org$;
    listen 80;
    listen 443 ssl http2;
    resolver 8.8.8.8;
   ssl_certificate /usr/local/nginx/conf/ssl/*.youdomain.org/fullchain.cer;
        ssl_certificate_key /usr/local/nginx/conf/ssl/*.youdomain.org/*.youdomain.org.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5";
        ssl_session_cache builtin:1000 shared:SSL:10m;
        # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048
        ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;
    #阻止搜索引擎蜘蛛收录站点，在下个 server 中也需加入。
    if ($http_user_agent ~* "Bot|Spider|Barkrowler|BingPreview|Feedfetcher-Google|ia_archiver|libwww-perl|MBCrawler|Mediapartners-Google|MSNot-media|Python|Teoma|Yahoo! Slurp|^$") {
        return 444;
    }
    
    if ($http_x_forwarded_proto = 'http')
    {
        return 301 $subdomain.m.mediawiki.youdomain.org$request_uri;
    }

    location / {
        proxy_pass https://$subdomain.m.mediawiki.org;
        proxy_buffering off;

        proxy_redirect https://$subdomain.wikimedia.org/ https://$subdomain.wikimedia.youdomain.org/;
        proxy_redirect https://$subdomain.m.wikimedia.org/ http://$subdomain.m.wikimedia.youdomain.org/;
        proxy_cookie_domain mediawiki.org mediawiki.youdomain.org;
        proxy_cookie_domain wikimedia.org wikimedia.youdomain.org;

        proxy_redirect ~^https://([\w\.]+).mediawiki.org/(.*?)$ https://$1.mediawiki.youdomain.org/$2;
        proxy_redirect ~^https://([\w\.]+).wikimedia.org/(.*?)$ https://$1.wikimedia.youdomain.org/$2;

        proxy_set_header       Host $subdomain.m.mediawiki.org;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding ''; 
        proxy_set_header Referer $http_referer;

        sub_filter             ".wikimedia.org" ".wikimedia.youdomain.org";
        sub_filter             ".wikipedia.org" ".wikipedia.youdomain.org";
        sub_filter             ".wmfusercontent.org" ".wmfusercontent.youdomain.org";
        sub_filter             ".wikimediafoundation.org" ".wikimediafoundation.youdomain.org";
        sub_filter             ".wiktionary.org" ".wiktionary.youdomain.org";
        sub_filter             ".wikivoyage.org" ".wikivoyage.youdomain.org";
        sub_filter             ".wikiversity.org" ".wikiversity.youdomain.org";
        sub_filter             ".wikisource.org" ".wikisource.youdomain.org";
        sub_filter             ".wikiquote.org" ".wikiquote.youdomain.org";
        sub_filter             ".wikinews.org" ".wikinews.youdomain.org";
        sub_filter             ".wikidata.org" ".wikidata.youdomain.org";
        sub_filter             ".wikibooks.org" ".wikibooks.youdomain.org";
        sub_filter             ".mediawiki.org" ".mediawiki.youdomain.org";

        sub_filter             "//wikimedia.org" "//wikimedia.youdomain.org";
        sub_filter             "//wikipedia.org" "//wikipedia.youdomain.org";
        sub_filter             "//wmfusercontent.org" "//wmfusercontent.youdomain.org";
        sub_filter             "//wikimediafoundation.org" "//wikimediafoundation.youdomain.org";
        sub_filter             "//wiktionary.org" "//wiktionary.youdomain.org";
        sub_filter             "//wikivoyage.org" "//wikivoyage.youdomain.org";
        sub_filter             "//wikiversity.org" "//wikiversity.youdomain.org";
        sub_filter             "//wikisource.org" "//wikisource.youdomain.org";
        sub_filter             "//wikiquote.org" "//wikiquote.youdomain.org";
        sub_filter             "//wikinews.org" "//wikinews.youdomain.org";
        sub_filter             "//wikidata.org" "//wikidata.youdomain.org";
        sub_filter             "//wikibooks.org" "//wikibooks.youdomain.org";
        sub_filter             "//mediawiki.org" "//mediawiki.youdomain.org";

        sub_filter_once        off;
        sub_filter_types       *;
      }
    }
    
